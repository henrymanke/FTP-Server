services:
  # Nginx Proxy
  nginx:
    image: nginx:latest
    container_name: nginx-server
    ports:
      - "8777:443"  # HTTPS auf Port 8777
    volumes:
      - ./ftpdata/storage_user/static:/usr/share/nginx/html/static  # Statische Dateien
      - ./ftpdata/storage_user/media:/usr/share/nginx/html/media    # Mediendateien
      - ./nginx.conf:/etc/nginx/nginx.conf  # Deine angepasste Nginx-Konfiguration
      - /etc/nginx/certs:/etc/nginx/certs:ro  # Let's Encrypt Zertifikate
      - /var/run/docker.sock:/var/run/docker.sock:ro  # Docker-Socket für Let's Encrypt Companion
    environment:
      - LETSENCRYPT_HOST=188.245.34.78  # Deine IP-Adresse oder Domain
      - LETSENCRYPT_EMAIL=henry.manke@developerakademie.com  # Deine E-Mail für Zertifikatserneuerungen
    restart: unless-stopped
    networks:
      - proxy-tier

  # Let's Encrypt Companion
  letsencrypt:
    image: nginxproxy/acme-companion
    container_name: letsencrypt
    environment:
      - DEFAULT_EMAIL=henry.manke@developerakademie.com  # E-Mail für Let's Encrypt Benachrichtigungen
      - NGINX_PROXY_CONTAINER=nginx-server  # Setze den Proxy-Container, um auf Nginx zugreifen zu können
    volumes:
      - /etc/nginx/certs:/etc/nginx/certs
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - nginx  # Abhängig von nginx, aber nicht umgekehrt
    restart: unless-stopped

  # FTP-Server
  vsftpd:
    image: fauria/vsftpd
    container_name: vsftpd-server
    ports:
      - "20:20"
      - "21:21"
      - "21100-21110:21100-21110"
    environment:
      - FTP_USER=${FTP_USER}
      - FTP_PASS=${FTP_PASS}
      - FILE_OPEN_MODE=0755
      - LOCAL_UMASK=022
    volumes:
      - ./ftpdata:/home/vsftpd  # FTP-Verzeichnis
    restart: unless-stopped
    networks:
      - proxy-tier

networks:
  proxy-tier:
    external: false
